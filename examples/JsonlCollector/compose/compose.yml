services:
  # Aspire Dashboard - provides UI for viewing OpenTelemetry data
  aspire-dashboard:
    image: mcr.microsoft.com/dotnet/aspire-dashboard:10.0
    container_name: jsonl-aspire-dashboard
    ports:
      - "18888:18888"  # Dashboard UI
      - "18889:18889"  # OTLP receiver
    environment:
      - DOTNET_DASHBOARD_UNSECURED_ALLOW_ANONYMOUS=true
      - DASHBOARD_OTLP_ENDPOINT_URL=http://+:18889
    networks:
      - otel-network

  # OpenTelemetry Collector - receives JSONL logs and forwards to Aspire
  otel-collector:
    image: otel/opentelemetry-collector-contrib:latest
    container_name: jsonl-otel-collector
    command: ["--config=/etc/otel-collector-config.yml"]
    volumes:
      - ./otel-collector-config.yml:/etc/otel-collector-config.yml:ro
      - ./data:/data
    depends_on:
      - aspire-dashboard
    networks:
      - otel-network

networks:
  otel-network:
    driver: bridge
